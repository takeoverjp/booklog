# プログラマーのためのCPU入門

## Links

- [プログラマーのためのCPU入門](https://www.lambdanote.com/products/cpu)

## 1. CPUは如何にしてソフトウェアを高速に実行するのか

- CPUは、「命令を順番に並べたものに基づいて、データの読み書きと加工を行う機械」
- 現代の汎用CPUは、広く使うことができるように、多様なアプリで共通して必要になる小さな操作が基本的な粒度となるように命令が設計されている
- 現代のCPUでは、特別な指示がない限り記述順序で後続の命令を次に実行すれば良い、という前提を置くことで高速化を実現するために、処理したい順番に命令を並べる方式が採用されている

## 2. 命令の密度を上げるさまざまな工夫

- CPUは、命令の処理を複数のステージに分割している。その分割の仕方はCPUによって異なるが、本書では便宜的に「命令フェッチ」「命令デコード」「命令実行」の３ステージとする。
- 逐次実行は安全で確実な処理方式だが、ステージごとにみるといつも２サイクルの待ちが発生する
- パイプライン処理では、選考命令の完了を待たずに次の命令を次々開始する方式をさし、逐次実行と比べて実行効率を飛躍的に控除することができるが、先行する命令の実行結果に応じたキャンセルが必要になりCPU設計はは複雑になる
- Meltdownはキャンセル処理の不適切さによって生じたセキュリティホール
- 「命令の実行サイクル数」は、主に命令実行ステージの先頭を起点として数える
- パイプライン化したCPUに対して、更に並列度を高め、処理帯域を向上するための方法として、スーパースカラ化とスーパーパイプライン化がある
- スーパースカラ化は、1クロックで処理可能な各ステージの命令数を増やす
- スーパーパイプライン化は、パイプラインステージを更に細分化することで、1クロックを短くする
- いずれのアプローチでも、１つの命令を処理しはじめて終わるまでのリードタイムは変わらず、CPU設計は複雑になり、限界がある
