# Links

https://www.oreilly.co.jp/books/9784814400423/

# 1. 攻撃者はいかにしてシステムを攻撃するのか

- ゼロデイ攻撃とは、修正方法がまだ知られていない脆弱性に対する攻撃のこと
- 標的型攻撃とは、特定の組織を狙った攻撃のこと
- ロシアによるウクライナ侵攻においては、現実の軍事行動とサイバー攻撃が並行して行われていた
  - PCの無力化・Webサイトの改ざん・プロバイダへの攻撃によるインターネット普通など
- 攻撃手法のモデルはいくつかあるが、この本ではUnified Kill Chainという18段階のプロセスを紹介している
- 偵察の手段としては、Shodan, Censysなどで公開されている情報による受動的偵察と、ポートスキャンやGoogle Hackingなどによる能動的偵察がある
- 自給自足攻撃：標的の端末にインストールされているソフトウェアを使った攻撃
  - Linuxにおける自給自足方法：[GTFOBins](https://gtfobins.github.io/)

- Subdomain Takeover
  - 有効なドメインに対応するホストが公開されていない場合、攻撃者に乗っ取られるリスクがある

- TOTP (Time-Based One Time Password) に対応したフィッシングサイトもある
- システムへの持続的なアクセス獲得のことを、永続化という
  - アカウントの変更や、自動起動プログラムの変更など
  - このあたりは被害を最小にするために特に気を付ける必要がある

- C2 (Command and Control) サーバとの通信は、正常な通信に紛れ込ませるため下記の手法などが取られる
  - ドメインフロンティング：TLSのSNIヘッダとHTTPのHostヘッダをずらすことで、CDNへの通信に紛れ込ませる
  - DNSトンネリング
    - C2サーバがDNSサーバを装い、DNSプロトコル上で情報をやり取りする
    - DNS通信ログを残すことが少ない、DNSプロトコル上は正常、C2と直接接続しないため、検出・追跡が難しい

- ピボッティングとは、踏み台アクセスのこと。開発環境としてはよく使うが、商品ではしっかり蓋じめが必要。
- 持ち出しにおいて、IDS/IPSに検知されないよう、正常系のアップロードに紛れ込ませる
  - アップロード先・タイミングなど

# 2. Scapyでポートスキャナを自作し動作原理を知ろう

- [Docker composeを使った環境構築](https://github.com/oreilly-japan/pentest-starting-with-port-scanner/blob/main/containers/README.md)
  - ペンテスター用のホストと攻撃対象のホストが同一Dockerネットワークにいるコンテナ群
  - Docker内とは言えmetasploit-frameworkをインストールしたりするので、ネットワークによっては遮断されているかも
  - 22番ポートや80番ポートを使うので、ホスト環境とポート番号かぶる可能性高し

- Scapy入門
  - パケット処理pythonライブラリ
  - 下記はICMPパケットを送ったときログ
  - `sr1`はネットワーク層でパケットを送信したのち１つの応答パケットを返す

```
>>> from scapy.all import *
>>> req = IP(dst="10.8.9.3")/ICMP()
>>> res = sr1(req, timeout=3)
Begin emission:
Finished sending 1 packets.
.*
Received 2 packets, got 1 answers, remaining 0 packets
>>> res.show()
###[ IP ]### 
  version   = 4
  ihl       = 5
  tos       = 0x0
  len       = 28
  id        = 28191
  flags     = 
  frag      = 0
  ttl       = 64
  proto     = icmp
  chksum    = 0xe6a8
  src       = 10.8.9.3
  dst       = 10.8.9.7
  \options   \
###[ ICMP ]### 
     type      = echo-reply
     code      = 0
     chksum    = 0x0
     id        = 0x0
     seq       = 0x0
     unused    = ''
```

- Scapyでパケットキャプチャも可能(`sniff`)
- Scapyの使い方を知りたいときは、`ls()`, `ls(ICMP)`, `help(ICMP)`, `lsc()`など
