# links

- https://www.oreilly.co.jp/books/9784814400560/

# 1. eBPFとは何か？なぜ、重要なのか？

- eBPFの主な用途
  - システムの性能トレース
  - 可観測性を持ったネットワーク機能
  - セキュリティ検知と不正操作防止の仕組み
  - カーネル内のほとんどの命令に対して追加の命令を実行させる仕組みであるkprobeに対してeBPFプログラムをアタッチできるようになったことが、システム全体をまたがって計測を行う方法の革命のきっかけとなった

- eBPFの名前
  - eBPFはもともとはextended BSD Packet Filterの略だが、守備範囲はパケットフィルタの範囲をとうに超えている
  - また、`bpf()`システムコールが使われているなど、eBPFとBPFを区別していないことも多い

- なぜ生まれたのか
  - 例えばシステムコールをフックして何らかの処理をしたい場合
  - カーネル自体にその機能を追加するためには、パッチの投稿・レビュー・承認、そのkernelのディストリビューションへの採用など、数年単位で時間がかかる
  - さらに、ユーザはその機能を有効にするためにシステムの再起動が必須となる
  - eBPFの場合、カーネルのリリースプロセスとは独立に、開発できる。さらに、動的ロードすればシステムの再起動も不要である。
  - カーネルモジュール（`insmod`などでロードする`.ko`ファイル）を使う場合、カーネルモジュールはカーネルとして動作し何でもできてしまうがゆえに、そのカーネルモジュールが安全であるか（クラッシュしない・脆弱性がない）を証明しなければならない
  - eBPFは、ロードするeBPFプログラムを検証器でチェックし、クラッシュしない・無限ループしない・不正なデータにアクセスしないことを保証する
  - eBPFはkernel空間で機械語として実行されるため、余分なデータをユーザ空間にコピーする必要がなくなり、性能上有利になるケースがある
  - サイドカーモデルでサービスメッシュのようなネットワークの機能を追加する場合、ネットワークスタックを１回多く通らなければならないが、eBPFの場合、従来どおりネットワークスタックを一度とおる構成のまま実現できる

# 2. eBPFの「Hello World」

# 3. eBPFプログラムの仕組み

# 4. bpf()システムコール

# 5. CO-RE, BTF, libbpf

# 6. eBPF検証器

# 7. eBPFのプログラムとアタッチメントタイプ

# 8. ネットワーク用eBPF

# 9. セキュリティ用eBPF

# 10. プログラミングeBPF

# 11. eBPFの将来の進化
