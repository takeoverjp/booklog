# links

- [進化的アーキテクチャ](https://www.oreilly.co.jp/books/9784873118567/)

# 本書を読む目的

- 変化に応じて実プロジェクトのアーキテクチャを適切に進化させられるようになる
- 適応度関数を理解し、実プロジェクトに適用できるようになる

# １．ソフトウェアアーキテクチャ

- ソフトウェアアーキテクチャとは、「（それが何であれ）重要なもの」であり、アーキテクトの仕事とは「（それが何であれ）重要なものを全て理解し、釣り合いを取ること」
- アーキテクチャ特性としての「進化可能性」は、「システムが進化していく中で他のアーキテクチャ特性を保護する」ことを意味する
- 進化的アーキテクチャとは、複数の次元にわたる漸進的で誘導的な変更を支援するものである。
- 「漸進的な変更」とは、制御可能な大きさのステップに分解して、段階的に変更することを意味する。
  - 例えば、すべてのコンポーネントについて一斉に新しいバージョンに移行するのではなく、各コンポーネントの事情に合わせて徐々に移行していく、など
- 「誘導的な変更」とは、重要なアーキテクチャ特性を保護できる方向にアーキテクチャの変更を誘導することを示す。
  - 「適応度関数」によって、変更がアーキテクチャ上の重要な特性にどのように影響するかを評価し、それらの特性が経年劣化するのを防ぐ
  - 適応度関数によって、組織の必要性やビジネス機能に即した決定を可能にし、さらにそれらの決定の根拠を明確かつ検証可能にする。
  - 急速な変化の必要性とシステムやアーキテクチャ特性への厳密さの必要性の間で、釣り合いを取るためのアプローチ。
- 「次元」とは、直行する方法で組み合わさることの多い、アーキテクチャの一部を指す
  - 例：技術、データ、セキュリティ、運用系、監査可能性、合法性、スケーラビリティ、

- コンウェイの法則
  - システムを設計するあらゆる組織は、必ずその組織のコミュニケーション構造に倣った構造を持つ設計を生み出す
  - 移譲が行われることで誰かが調査できる範囲が狭まるたびに、実際に追い求めることができる設計の選択肢の種類も狭まる
- 逆コンウェイ戦略
  - サイロ化した技術アーキテクチャによる分割ではなく、サービス境界を中心にチームを組織する
  - こういう組織づくりのときの理由って、もっと言っていったほうが良いと思う

- 「進化」という名前に込めた想い
  - 「漸進的」と「誘導的」を込めた
  - 生物学上の「進化」に倣い、「進化」という言葉に目的に沿った、絶え間なく変化する環境で生き残ることができるシステムを持つこと
  - これぐらいしっかり名前付けに意図を持ちたい

# ２．適応度関数

- **アーキテクチャの適応度関数**は、あるアーキテクチャ特性がどの程度満たされているかを評価する客観的な指標を与える
- 特定のアーキテクチャ特性に対応する適応度関数だけでなく、**システム全体の適応度関数**を定義することもできる。この適応度関数によって、トレードオフを主観的ではなく具体的に評価することができる。

- 適応度関数の分類
  - アトミック(単一次元) vs ホリスティック(複数次元)
  - トリガー式 vs 継続的
  - 評価指標が静的 vs 評価指標が動的(状況による)
  - 自動 vs 手動
  - 一時的
    - 例：暗号化ライブラリの重要な更新のリマインダ
  - ドメイン特化（法規など）
  - 主要なもの(これらを中心とした変更を容易にできるアーキテクチャを目指す) vs 関連性のあるもの(機能レベルで考慮する) vs 関連性のないもの(アーキテクチャと関係ない)

- 全ての適応度関数を最初に明らかにすることはできないが、早い段階で特定し優先順位をつけることが望ましい
  - 適応度関数を満たすために簡単に変更できなければならない責務を、コードベース全体に分散させてしまったりする

- 適応度関数を実行した結果を共有スペースなどで可視化することで、主要な適応度関数と関連性のある適応度関数の知識を保ち続ける

# ３．漸進的な変更を支える技術

- 漸進的な変更を支えるために、バージョンの互換性をプロキシによって維持しながらマイグレーションしたりする
- デプロイメントパイプラインに、全てのアトミックな適応度関数とホリスティックな適応度関数による検証を追加することで、アーキテクチャ上の関心事についての評価から曖昧さや主幹を減らし、開発プラクティスに対する信頼を増すことができる
- 架空の例として、下記のような適応度関数をあげている
  - アトミックな適応度関数：自動スケーラビリティテスト・セキュリティ侵入テスト
  - ホリスティックな適応度関数：統合点を保護する契約に対するテスト、横断的なスケーラビリティテスト
  - 手動の適応度関数：セキュリティレビュー・監査

# ４．アーキテクチャ上の結合

- 最小のオーバーヘッドで最大の利益をもたらすために結合すべきアーキテクチャの次元を特定したい
- モジュールは論理的なグループ化を意味し、コンポーネントは物理的な分割方法を意味する
- アーキテクチャ漁師とは、高度な機能的凝集を持つ、独立してデプロイ可能なコンポーネントを意味する

- アーキテクチャスタイルの進化可能性
  - 巨大な泥団子
    - 管理されていない結合が多く変更は困難である
    - 保護対象を識別する前提となる構造がないため、適応度関数を構築することも難しい
  - 非構造化モノリス
    - 高度に結合しているため変更が波及し、漸進的に行うことは難しい
    - 高度な結合のためにスケーラビリティやパフォーマンスに対応することは難しい
  - レイヤ化アーキテクチャモノリス
    - コンウェイの法則に従った組織では、レイヤを縦断するサービス単位の変更が難しい
    - レイヤによる関心の分離により多くの部品を独立してテストできるため、適応度関数は構築しやすい
    - レイヤに閉じた変更であれば、最小限の副作用で簡単に交換できる
  - モジュール式モノリス
    - モジュールのデプロイ可能性により漸進的な変更が容易かどうかが決まる
    - モックなどのテスト技法が容易になり適応度関数を構築しやすい
  - マイクロカーネル式モノリス
    - ほとんどの変更はプラグインのみ修正・デプロイすればよいはずなので、漸進的な変更は容易
    - コアとプラグインのそれぞれに対して適応度関数を定義すれば良い
    - 結合特性がマイクロカーネルパターン自体によって明確に定義されているので、変更を容易にするが、プラグイン管で依存がある場合は適応度関数によって適切な結合であることを保証しなければならない
  - Broker型イベント駆動アーキテクチャ
    - 依存は少ないので変更は容易
    - 非同期通信なので、テストは難しい
    - アトミックな適応度関数の構築は容易だが、調整役がいないので、ホリスティックな適応度関数の構築は難しい
    - 結合はサービスとメッセージの間に生じる
  - Mediator型イベント駆動アーキテクチャ
    - 依存は少ないので変更は容易
    - 非同期通信なので、テストは難しい
    - 調整役がいるので、ホリスティックな適応度関数の構築も容易
    - 調整役との結合が増えるため、変更の時に副作用を考慮する必要が生じる
  - エンタープライズサービスバス駆動サービス指向アーキテクチャ (ESB駆動SOA)
    - ESB駆動SOAは進化の性質を示すようには設計されていない
    - 組織構造やデプロイ単位が横軸になっていることが多く、変更に必要なコストが大きい
    - 完結している部品が１つもないので、テストの実施が難しく、アトミックな適応度関数を構築することは事実上不可能である
    - ESB駆動SOAが目的とする再利用を推し進め、各ワークフローの本質を形にできれば、将来の開発はサービスの接続だけでできるかもしれないが、独立して進化できない以上一般的にそのサービスのサポートは貧弱になってしまう
  - マイクロサービスアーキテクチャ
    - ビジネスドメインごとに全ての従属コンポーネントをカプセル化することで、不適切な結合を防止し、他のサービスを中断することなく、あるサービスを置き換えることが目標
    - 「無共有アーキテクチャ」とも呼ばれる
    - ビジネスドメインごとに高度に粗結合になっているため、開発と運用どちらの側面でも、漸進的な変更が容易である
    - アトミックな適応度関数とホリスティックな適応度関数の両方を容易に構築できる
    - 結合は、メッセージング呼び出しと、サービステンプレート（共通処理）のみで管理可能
  - サービスベースアーキテクチャ
    - 既存のアプリケーションをマイクロサービスに移行するためのアーキテクチャ
    - ドメイン中心で分割することは同じだが、粒度がマイクロサービスアーキテクチャより大きい
    - サービス粒度が大きくなるため、変更の単位も大きくなり、変更は容易ではなくなる
    - データベースは細分化することは難しいので、モノリシックであることが多い
    - 統合ミドルウェアによって、レガシーシステムとの橋渡しをし、サービスの追加や変更を容易にする
  - サーバーレスアーキテクチャ
    - インフラは隠蔽されており、デプロイメントパイプラインと相性がいい
    - サードパーティのAPIを保証するためのホリスティックな結合度関数が必要
    - 状態やトランザクションといった複雑性は呼び出し側に押し付けられる
    - 多くのユースケースには素早く対応できるが、完全に要件を満たすものを作るのは難しい傾向が強い

- 循環依存を避けるために、コーディング標準は役に立たない。検証メカニズムを確立するべきである

# ５．進化的データ

- 

# ６．進化可能なアーキテクチャの構築

- 

# ７．進化的アーキテクチャの落とし穴とアンチパターン

- 

# ８．進化的アーキテクチャの実践

- 

