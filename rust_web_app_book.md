# ＲｕｓｔによるＷｅｂアプリケーション開発　設計からリリース・運用まで

## Links

https://bookclub.kodansha.co.jp/product?item=0000398182

## 1. 本書で開発するもの

- 開発対象の機能要件と、アーキテクチャ、API設計を書いている
- 後続の章の前提の位置付けだが、簡易的なものとは言えWebシステム開発時にざっくり必要となるインプットのリストとしても勉強になる

## 2. 開発環境の構築

- cargo-makeを使うことで、makeのようにタスクの依存関係を管理することができる
- cargo-makeでは、watch設定により、ファイルを変更したときに自動的にコマンドを実行することができる

## 3. 最小構成アプリケーションの実装

- cargo add で依存クレートを追加できる
- [Webサーバーアーキテクチャ進化論2023](https://blog.ojisan.io/server-architecture-2023/)
- async関数にすることで、芋づる式にasyncにしなければならなくなる場合がある
- tokioのランタイムマクロがなにをしているかは、cargo expandで確認できる
- anyhowクレートを使うことで、任意のエラーを統一的に処理することができる
- cargo-nextestを使うことで、ユニットテストの実行コストを下げたりすることができる

## 4. 蔵書管理サーバーアプリケーションの設計

- ワークスペースを使うことで、コンパイル時間の削減とディスクスペースの節約を計ることができる

## 5. 蔵書管理サーバーの実装

- todo!マクロは将来実装する意思を示し、unimplemented!マクロはその意思を示さない
- todo!内部で呼び出すpanic!マクロは、発散型を返し、それは任意の型に変換可能なので、コンパイルが通る
- anyhowクレートを使うことで任意のエラーを統一的に扱うことができる一方で、エラー種別ごとに処理を細かく切り替えるときにはthiserrorクレートが便利である
- APIサーバーとフロントエンドサーバーがことなるドメインに配置される場合、APIサーバーにCORSの設定が必要となる

## 6. システムの結合とテスト

- rstestクレートを使うことで、フィクスチャやパラメータテストが可能になる
- mockallクレートを使うことで、モックを簡単に実装できる

## 7. アプリケーションの運用

- tracingクレートはログに非同期処理を追跡するための情報を埋め込めるように設計されている
- tracingクレートはtokioコミュニティによってメンテナンスされている
- ビルドスピードの改善
  - 最新のRustを使う
  - cargo checkを使う
  - cargo build --timibgsでボトルネックを特定する
  - cargo-machete で不要な依存を削除する
  - ミニマムなクレートにかえる
  - cargo-wizardでコンパイルオプションを調整する
  - 高速なリンカを使う
  - dockerでマルチステージビルドを使う
